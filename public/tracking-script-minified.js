!function(){"use strict";const e={API_BASE_URL:"https://gestao-educa.autoflixtreinamentos.com/api/tracking",DOMAIN:window.location.hostname,SESSION_DURATION:18e5,HEARTBEAT_INTERVAL:3e4,SCROLL_THRESHOLD:5,TIME_THRESHOLD:5};let t=null,n=null,o=Date.now(),a=0,r=0,i=null,s=!1;function c(){return"xxxx-xxxx-4xxx-yxxx".replace(/[xy]/g,(function(e){const t=16*Math.random()|0;return("x"===e?t:3&t|8).toString(16)}))}function l(){let t=localStorage.getItem("eja_tracking_session");const n=localStorage.getItem("eja_tracking_session_time"),o=Date.now();return t&&n&&o-parseInt(n)<=e.SESSION_DURATION||(t=c(),localStorage.setItem("eja_tracking_session",t)),localStorage.setItem("eja_tracking_session_time",o.toString()),t}function u(){const e=navigator.userAgent;let t="desktop";/tablet|ipad|playbook|silk/i.test(e)?t="tablet":/mobile|iphone|ipod|android|blackberry|opera|mini|windows\sce|palm|smartphone|iemobile/i.test(e)&&(t="mobile");let n="unknown",o="";e.indexOf("Chrome")>-1?(n="Chrome",o=e.match(/Chrome\/([0-9.]+)/)?.[1]||""):e.indexOf("Firefox")>-1?(n="Firefox",o=e.match(/Firefox\/([0-9.]+)/)?.[1]||""):e.indexOf("Safari")>-1?(n="Safari",o=e.match(/Version\/([0-9.]+)/)?.[1]||""):e.indexOf("Edge")>-1&&(n="Edge",o=e.match(/Edge\/([0-9.]+)/)?.[1]||"");let a="unknown",r="";return e.indexOf("Windows")>-1?(a="Windows",r=e.match(/Windows NT ([0-9.]+)/)?.[1]||""):e.indexOf("Mac")>-1?(a="macOS",r=e.match(/Mac OS X ([0-9_.]+)/)?.[1]?.replace(/_/g,".")||""):e.indexOf("Linux")>-1?a="Linux":e.indexOf("Android")>-1?(a="Android",r=e.match(/Android ([0-9.]+)/)?.[1]||""):e.indexOf("iOS")>-1&&(a="iOS",r=e.match(/OS ([0-9_]+)/)?.[1]?.replace(/_/g,".")||""),{device_type:t,browser:n,browser_version:o,os:a,os_version:r,screen_resolution:`${screen.width}x${screen.height}`,user_agent:e}}function d(){const e=new URLSearchParams(window.location.search);return{utm_source:e.get("utm_source"),utm_medium:e.get("utm_medium"),utm_campaign:e.get("utm_campaign"),utm_term:e.get("utm_term"),utm_content:e.get("utm_content")}}async function g(t,n){try{const o=await fetch(`${e.API_BASE_URL}${t}`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(n)});if(!o.ok)throw new Error(`HTTP error! status: ${o.status}`);return await o.json()}catch(e){return console.warn("Tracking API error:",e),null}}async function m(){if(s)return;t=l();const n=u(),o=d(),a={session_id:t,domain:e.DOMAIN,...n,referrer:document.referrer||null,...o},r=await g("/session",a);r&&r.success&&(s=!0,console.log("Tracking session initialized:",t))}async function p(){if(!s||!t)return;const e={session_id:t,page_url:window.location.href,page_title:document.title,page_path:window.location.pathname,load_time:performance.timing?performance.timing.loadEventEnd-performance.timing.navigationStart:null},o=await g("/pageview",e);o&&o.success&&(n=o.pageview.id,console.log("Pageview tracked:",n))}async function f(e){s&&t&&await g("/interaction",{session_id:t,pageview_id:n,page_url:window.location.href,...e})}async function h(e){s&&t&&await g("/event",{session_id:t,page_url:window.location.href,...e})}async function w(){if(!s||!t||!n)return;r=Math.floor((Date.now()-o)/1e3);const e={session_id:t,pageview_id:n,time_on_page:r,scroll_depth:a};await g("/page-time",e)}function v(){document.addEventListener("click",(function(e){const t=e.target;t.getBoundingClientRect();f({interaction_type:"click",element_type:t.tagName.toLowerCase(),element_id:t.id||null,element_class:t.className||null,element_text:t.textContent?.substring(0,200)||null,element_href:t.href||null,click_x:Math.round(e.clientX),click_y:Math.round(e.clientY)})}))}function y(){let t;window.addEventListener("scroll",(function(){clearTimeout(t),t=setTimeout((function(){const t=window.pageYOffset||document.documentElement.scrollTop,n=Math.max(document.body.scrollHeight,document.body.offsetHeight,document.documentElement.clientHeight,document.documentElement.scrollHeight,document.documentElement.offsetHeight),o=window.innerHeight,r=Math.round((t+o)/n*100);r>a&&r>=e.SCROLL_THRESHOLD&&(a=r,f({interaction_type:"scroll",scroll_position:r}))}),250)}))}function b(){document.addEventListener("submit",(function(e){const t=e.target;if("form"===t.tagName.toLowerCase()){const e=new FormData(t),n={};for(let[t,o]of e.entries())t.toLowerCase().includes("password")||t.toLowerCase().includes("credit")||t.toLowerCase().includes("card")||(n[t]="string"==typeof o?o.substring(0,100):o);f({interaction_type:"form_submit",element_type:"form",element_id:t.id||null,element_class:t.className||null,form_data:n})}}))}"loading"===document.readyState?document.addEventListener("DOMContentLoaded",(function(){m().then((()=>{s&&(p(),v(),y(),b(),function(){window.addEventListener("beforeunload",(function(){w()})),document.addEventListener("visibilitychange",(function(){"hidden"===document.visibilityState&&w()}))}(),i=setInterval(w,e.HEARTBEAT_INTERVAL),console.log("EJA Tracking initialized successfully"))}))})):m().then((()=>{s&&(p(),v(),y(),b(),function(){window.addEventListener("beforeunload",(function(){w()})),document.addEventListener("visibilitychange",(function(){"hidden"===document.visibilityState&&w()}))}(),i=setInterval(w,e.HEARTBEAT_INTERVAL),console.log("EJA Tracking initialized successfully"))})),window.EJATracking={trackEvent:h,trackInteraction:f,getSessionId:()=>t}}();